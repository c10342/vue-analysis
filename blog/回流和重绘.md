# 回流和重绘概念

- 回流：布局引擎根据样式计算每个盒子在页面的大小和位置
- 重绘：当计算好盒模型的位置，大小和其他属性后，浏览器根据每个盒子的特性进行绘制

# 浏览器解析渲染机制

- 解析 html，生成 dom 树，解析 css，生成 css 树
- 将 dom 树和 css 树进行结合，生成渲染树
- 然后就是布局，也就是回流，根据生成的渲染树，进行回流，得到节点的几何信息（位置，大小）
- 重绘，根据渲染树以及回流得到的几何信息，得到节点的绝对像素
- 将像素发送给 gpu，展示在页面上

# 回流触发时机

- 添加或者删除 dom 元素
- 元素位置和大小发生了变化
- 浏览器窗口尺寸发生变化
- 读取一些特定属性的值，比如：offsettop，offsetleft，clientheight 等，这些属性都是需要通过及时计算得到的，浏览器为了获取这些值，会进行回流

# 重绘触发时机

背-景色，文本颜色这些修改

# 浏览器优化机制

- 大多数浏览器通过队列化修改并批量执行来优化重排。浏览器会将修改操作放入到队列中，知道过了一段时间或者到达一个法制，才清空队列。
- 当你需要获取布局信息的时候，会强制刷新队列，也就是读取 offset 值，需要通过触发回流和重绘来得到正确的值

# 减少回流

- 图片尽量给个宽高，不然加载完毕之后会触发
- 避免设置内联样式
- 当需要设置多个元素样式时，通过改变元素的 class 类名来实现
- 如果需要执行动画，将元素进行定位，脱离文档流，减少对其他元素的影响
- 使用 css3 硬件加速，可以让 transform、opacity、filters 这些动画不会引起回流重绘
- 避免使用 table 布局，table 中的每个元素大小和内容的改动，都会导致整个 table 重新计算
- 使用 js 动态插入多个节点时，使用 documentfragment，创建后一次性插入，避免多次
- 如果需要使用 clientheight 值的时候，进行缓存
- 也可以设置 display：none，然后再去修改 dom 元素，这些操作都不会触发回流和重绘，等修改 dom 修改之后，在设置为 display：block，这个过程称离线操作

# css 优化

- 合理使用选择器。css 匹配规则是从右往左的。所以在编写的时候，不要前扰过多复杂的选择器，使用了 id 选择器就没必要在进行嵌套了，通配符和属性选择器效率最低，避免使用，尽量使用 class 类名
- 减少使用昂贵的属性，比如`box-shadow`，`border-radius`，`filter`等，这些都会较低浏览器的渲染性能
- 不要使用@import 引入 css，会影响浏览器的并行下载
- 动画或者过度尽量使用 transform 和 opacity 来使用，不要使用 left 和 top 属性
